<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Socioeconomic Status Scale (FSESS) Calculator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Cairo:wght@400;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
        [dir="rtl"] body, [dir="rtl"] .text-right-rtl {
            font-family: 'Cairo', sans-serif;
            text-align: right;
        }
        [dir="rtl"] .text-left-rtl {
            text-align: right;
        }
        [dir="ltr"] .text-left-rtl {
            text-align: left;
        }
        [dir="rtl"] select, [dir="rtl"] input[type="radio"], [dir="rtl"] input[type="checkbox"] {
            margin-left: 0.75rem;
            margin-right: 0;
        }
        [dir="rtl"] .space-x-reverse > * {
            margin-right: 0.75rem !important;
            margin-left: 0 !important;
        }
    </style>
</head>
<body class="p-4 sm:p-8">
    
    <div id="app" class="max-w-4xl mx-auto bg-white shadow-xl rounded-xl p-6 sm:p-10 border border-gray-100">
        <h1 id="main-title" class="text-3xl sm:text-4xl font-extrabold text-blue-700 mb-6 text-left">
            FSESS Calculator
        </h1>

        <!-- Language Selection -->
        <div id="language-select-screen">
            <h2 class="text-2xl font-bold text-gray-700 mb-4 text-left">Choose Language | ุงุฎุชุฑ ุงููุบุฉ</h2>
            <p class="text-gray-700 mb-8 text-left leading-loose">
                Please select your preferred language to continue. | ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ูุบุชู ุงูููุถูุฉ ูููุชุงุจุนุฉ.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button onclick="setLanguage('en')" class="w-full sm:w-1/2 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200 shadow-md">
                    English (EN)
                </button>
                <button onclick="setLanguage('ar')" class="w-full sm:w-1/2 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200 shadow-md">
                    ุงูุนุฑุจูุฉ (AR)
                </button>
            </div>
        </div>
        
        <!-- Intro Screen -->
        <div id="intro-screen" class="hidden">
            <h2 id="welcome-title" class="text-2xl font-bold text-gray-700 mb-4 text-left-rtl">Welcome to the FSESS Calculator</h2>
            <div id="welcome-text" class="text-gray-700 mb-8 leading-loose text-left-rtl text-sm space-y-3 border-b pb-6"></div>
            <button onclick="startCalculation()" id="start-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200 shadow-md">
                Start Calculation
            </button>
        </div>

        <!-- Calculation Screen -->
        <div id="calculator-screen" class="hidden">
            <div id="error-message" class="mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg text-sm hidden text-center mb-6"></div>

            <form id="ses-form" class="space-y-8">
                <h2 id="calc-title" class="text-2xl font-bold text-gray-700 border-b pb-2 mb-4 text-left-rtl">1. Family Demographics</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Husband -->
                    <div class="p-4 border rounded-lg bg-gray-50 space-y-4">
                        <h3 id="husband-title" class="text-lg font-semibold text-gray-700 text-left-rtl">A. Husband/Male Head</h3>
                        <label id="edu-h-label" class="block text-sm font-medium text-gray-700 text-left-rtl">Education Level</label>
                        <select id="edu_h" class="mt-1 block w-full pl-3 pr-10 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"></select>
                        
                        <label id="occ-h-label" class="block text-sm font-medium text-gray-700 text-left-rtl">Occupation Category</label>
                        <select id="occ_h" class="mt-1 block w-full pl-3 pr-10 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"></select>
                    </div>

                    <!-- Wife -->
                    <div class="p-4 border rounded-lg bg-gray-50 space-y-4">
                        <h3 id="wife-title" class="text-lg font-semibold text-gray-700 text-left-rtl">B. Wife/Female Head</h3>
                        <label id="edu-w-label" class="block text-sm font-medium text-gray-700 text-left-rtl">Education Level</label>
                        <select id="edu_w" class="mt-1 block w-full pl-3 pr-10 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"></select>
                        
                        <label id="occ-w-label" class="block text-sm font-medium text-gray-700 text-left-rtl">Occupation Category</label>
                        <select id="occ_w" class="mt-1 block w-full pl-3 pr-10 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"></select>
                    </div>
                </div>

                <h2 id="finance-title" class="text-2xl font-bold text-gray-700 border-b pb-2 mb-4 text-left-rtl">2. Family Finances</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="p-4 border rounded-lg bg-gray-50 space-y-4">
                        <h3 id="income-title" class="text-lg font-semibold text-gray-700 text-left-rtl">C. Income</h3>
                        <div class="space-y-2" id="income-radio-group"></div>
                    </div>
                    <div class="p-4 border rounded-lg bg-gray-50 space-y-4">
                        <h3 id="assets-title" class="text-lg font-semibold text-gray-700 text-left-rtl">D. Assets</h3>
                        <div class="grid grid-cols-2 gap-x-4 gap-y-2" id="assets-checkbox-group"></div>
                    </div>
                </div>
            </form>
            <button onclick="calculateSES()" id="calculate-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200 shadow-md mt-8">Calculate</button>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="mt-8 hidden">
            <h2 id="results-title" class="text-2xl font-bold text-gray-700 mb-6 text-left-rtl">Results</h2>
            <div id="result-score" class="p-4 sm:p-6 bg-green-50 border border-green-200 rounded-lg mb-4 text-center"></div>
            <div id="result-classification" class="p-4 sm:p-6 bg-green-100 border border-green-300 rounded-lg mb-6 text-center"></div>
            <h3 id="breakdown-title" class="text-xl font-bold text-gray-700 mt-6 mb-4 text-left-rtl">Breakdown</h3>
            <table class="min-w-full bg-white border border-gray-200 rounded-lg overflow-hidden">
                <thead class="bg-gray-50">
                    <tr>
                        <th id="th-domain" class="py-3 px-4 text-sm font-semibold text-gray-600 border-b text-left-rtl">Domain</th>
                        <th id="th-score" class="py-3 px-4 text-sm font-semibold text-gray-600 border-b text-center">Score</th>
                        <th id="th-max" class="py-3 px-4 text-sm font-semibold text-gray-600 border-b text-center">Max</th>
                    </tr>
                </thead>
                <tbody id="breakdown-body" class="divide-y divide-gray-100"></tbody>
            </table>
            <button onclick="startAgain()" id="start-again-button" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200 shadow-md mt-8">Start Again</button>
        </div>
    </div>

    <script>
        const CITATION = `El-Gilany, AH., Baklola, M., Terra, M. et al. Refining and validation of Family Socioeconomic Status Scale (FSESS) for health research in Egypt. BMC Public Health (2026). <a href="https://doi.org/10.1186/s12889-026-26282-y" target="_blank" class="text-blue-600 hover:underline">https://doi.org/10.1186/s12889-026-26282-y</a>`;

        const LANG_AR = {
            code: 'ar', dir: 'rtl',
            strings: {
                TITLE: 'ุญุงุณุจุฉ ูููุงุณ ุงููุถุน ุงูุงุฌุชูุงุนู ูุงูุงูุชุตุงุฏู ููุฃุณุฑุฉ (FSESS)',
                WELCOME_TITLE: 'ูุฑุญุจุงู ุจู ูู ุญุงุณุจุฉ FSESS',
                WELCOME_TEXT_HTML: `<h3 class="text-lg font-bold text-gray-800 mb-2">ูุธุฑุฉ ุนุงูุฉ</h3><p>ุชุนุชุจุฑ ุญุงุณุจุฉ ูููุงุณ ุงููุถุน ุงูุงุฌุชูุงุนู ูุงูุงูุชุตุงุฏู ููุฃุณุฑุฉ (FSESS) ุฃุฏุงุฉ ุฅููุชุฑูููุฉ ููุชูุญุฉ ุงููุตุฏุฑ ูุตููุฉ ูููุงุณ ูุชุตููู ุงููุถุน ุงูุงุฌุชูุงุนู ูุงูุงูุชุตุงุฏู (SES) ููุงุณุชุฎุฏุงู ูู ุงูุฃุจุญุงุซ ุงูุตุญูุฉ ูุงูุงุฌุชูุงุนูุฉ ูุงููุจุงุฆูุฉ ูู ุงูุนุงูู ุงูุนุฑุจู ูุฏูููุงู.</p><p>ุชู ุชุทููุฑูุง ูุฌุฒุก ูู ุฏุฑุงุณุฉ:</p><p class="font-semibold italic">${CITATION}</p><p class="text-blue-700 font-bold">ููุงุญุธุฉ ุงูุฎุตูุตูุฉ: ูุฐู ุงูุฃุฏุงุฉ ุชุนูู ูุญููุงู ุจุงููุงูู. ูุง ูุชู ุญูุธ ุฃู ุจูุงูุงุช ุชุฏุฎููุง.</p>`,
                START_CALCULATION: 'ุงุจุฏุฃ ุงูุญุณุงุจ',
                CALCULATION_TITLE: '1. ุงูุจูุงูุงุช ุงูุฏูููุบุฑุงููุฉ ููุฃุณุฑุฉ',
                FINANCE_TITLE: '2. ุงูุดุคูู ุงููุงููุฉ ูููุชููุงุช ุงูุฃุณุฑุฉ',
                HUSBAND_TITLE: 'ุฃ. ุงูุฒูุฌ / ุฑุจ ุงูุฃุณุฑุฉ',
                WIFE_TITLE: 'ุจ. ุงูุฒูุฌุฉ / ุฑุจุฉ ุงูุฃุณุฑุฉ',
                EDU_LABEL: 'ูุณุชูู ุงูุชุนููู',
                OCC_LABEL: 'ุชุตููู ุงููููุฉ',
                INCOME_TITLE: 'ุฌ. ุฏุฎู ุงูุฃุณุฑุฉ (ุงูุญุฏ ุงูุฃูุตู 3 ููุงุท)',
                ASSETS_TITLE: 'ุฏ. ููุชููุงุช ุงูุฃุณุฑุฉ (ุงูุญุฏ ุงูุฃูุตู 10 ููุงุท)',
                CALCULATE_BUTTON: '๐ฏ ุญุณุงุจ ุงูุฏุฑุฌุฉ ุงููููุฉ',
                RESULTS_TITLE: 'ูุชุงุฆุฌ ุงูุญุณุงุจ',
                SCORE_TOTAL: 'ุงูุฏุฑุฌุฉ ุงููููุฉ ูู ',
                CLASSIFICATION_FINAL: 'ุงูุชุตููู ุงูููุงุฆู:',
                SCORE_BREAKDOWN: 'ุชูุตูู ุงูุฏุฑุฌุงุช',
                START_AGAIN: 'ุงุจุฏุฃ ูู ุฌุฏูุฏ',
                ERROR_MISSING: 'ุงูุฑุฌุงุก ุงูุชุฃูุฏ ูู ุงุฎุชูุงุฑ ุฌููุน ุงูุฎูุงุฑุงุช.',
                ERROR_NA_BOTH: "ุฎุทุฃ: ูุง ูููู ุงุฎุชูุงุฑ 'ูุง ููุทุจู' ูููุง ุงูุฒูุฌูู.",
                ERROR_NA_INCONSISTENT: "ุฎุทุฃ: ุฅุฐุง ุชู ุงุฎุชูุงุฑ 'ูุง ููุทุจู' ูู ุงูุชุนููู ุฃู ุงููููุฉุ ููุฌุจ ุงุฎุชูุงุฑู ููููููุง ูููุณ ุงูุฒูุฌ.",
                DOMAIN_EDU: 'ุงูุชุนููู (ุงูุฒูุฌ ูุงูุฒูุฌุฉ)', DOMAIN_OCC: 'ุงููููุฉ (ุงูุฒูุฌ ูุงูุฒูุฌุฉ)', DOMAIN_INC: 'ุงูุฏุฎู', DOMAIN_ASSET: 'ุงูููุชููุงุช',
                TABLE_DOMAIN: 'ุงููุฌุงู', TABLE_SCORE: 'ุงูุฏุฑุฌุฉ', TABLE_MAX: 'ุงูุญุฏ ุงูุฃูุตู',
                CLASSIFICATIONS: { HIGH: 'ูุฑุชูุน', MIDDLE: 'ูุชูุณุท', LOW: 'ููุฎูุถ', VERY_LOW: 'ููุฎูุถ ุฌุฏูุง' },
                OPTIONS_EDU: [
                    { value: "", label: "-- ุงุฎุชุฑ --" },
                    { value: "0", label: "ูุง ููุทุจู (ุงูููุงุฉ ุฃู ุงูุทูุงู)", na: true },
                    { value: "2", label: "ุฃูู" }, { value: "4", label: "ุฃูู ูู ุซุงููู" },
                    { value: "6", label: "ุซุงููู" }, { value: "8", label: "ุฌุงูุนู" }, { value: "10", label: "ุฏุฑุงุณุงุช ุนููุง" }
                ],
                OPTIONS_OCC: [
                    { value: "", label: "-- ุงุฎุชุฑ --" },
                    { value: "0", label: "ูุง ููุทุจู (ุงูููุงุฉ ุฃู ุงูุทูุงู)", na: true },
                    { value: "0", label: "ูุง ูุนูู โ ุฑุจุฉ ููุฒู" }, { value: "1", label: "ุนุงูู ุบูุฑ ูุงูุฑ" },
                    { value: "2", label: "ุนุงูู ูุงูุฑ" }, { value: "3", label: "ุฌููุฏ ูุตู ุถุจุงุท ุงูุฌูุด ูุงูุดุฑุทุฉ" },
                    { value: "4", label: "ุงูุนุงูููู ูู ุงูุชุฌุงุฑุฉ ุฃู ุงูุฃุนูุงู ุงูุญุฑุฉ" }, { value: "5", label: "ุงููุชุจุฉ ูููุธูู ุงูููุงุชุจ" },
                    { value: "6", label: "ุฃุตุญุงุจ ุงูููู ุงูุนูููุฉ ูุงููุดุฑุนูู ูุงููุฏูุฑูู ูุถุจุงุท ุงูุฌูุด ูุงูุดุฑุทุฉ" }
                ]
            }
        };

        const LANG_EN = {
            code: 'en', dir: 'ltr',
            strings: {
                TITLE: 'Family Socioeconomic Status Scale (FSESS) Calculator',
                WELCOME_TITLE: 'Welcome to the FSESS Calculator',
                WELCOME_TEXT_HTML: `<h3 class="text-lg font-bold text-gray-800 mb-2">Overview</h3><p>The FSESS Calculator is an open-access tool designed for health and social research across the Arab world and internationally.</p><p>Based on the study:</p><p class="font-semibold italic">${CITATION}</p><p class="text-blue-700 font-bold">Privacy Note: This tool runs locally. No data is stored.</p>`,
                START_CALCULATION: 'Start Calculation',
                CALCULATION_TITLE: '1. Family Demographics',
                FINANCE_TITLE: '2. Family Finances',
                HUSBAND_TITLE: 'A. Husband/Male Head',
                WIFE_TITLE: 'B. Wife/Female Head',
                EDU_LABEL: 'Education Level',
                OCC_LABEL: 'Occupation Category',
                INCOME_TITLE: 'C. Family Income (Max 3 points)',
                ASSETS_TITLE: 'D. Assets & Possessions (Max 10 points)',
                CALCULATE_BUTTON: '๐ฏ Calculate Total Score',
                RESULTS_TITLE: 'Calculation Results',
                SCORE_TOTAL: 'Total Score out of ',
                CLASSIFICATION_FINAL: 'Final Classification:',
                SCORE_BREAKDOWN: 'Score Breakdown',
                START_AGAIN: 'Start Again',
                ERROR_MISSING: 'Please ensure all fields are selected.',
                ERROR_NA_BOTH: "Error: Cannot select 'Non-applicable' for both spouses.",
                ERROR_NA_INCONSISTENT: "Error: If 'Non-applicable' is selected, it must be selected for both Education and Occupation of that spouse.",
                DOMAIN_EDU: 'Education (Husband & Wife)', DOMAIN_OCC: 'Occupation (Husband & Wife)', DOMAIN_INC: 'Income', DOMAIN_ASSET: 'Assets',
                TABLE_DOMAIN: 'Domain', TABLE_SCORE: 'Score', TABLE_MAX: 'Max Score',
                CLASSIFICATIONS: { HIGH: 'High', MIDDLE: 'Middle', LOW: 'Low', VERY_LOW: 'Very Low' },
                OPTIONS_EDU: [
                    { value: "", label: "-- Select --" },
                    { value: "0", label: "Non-applicable (death/divorce)", na: true },
                    { value: "2", label: "Illiterate" }, { value: "4", label: "Less than secondary" },
                    { value: "6", label: "Secondary" }, { value: "8", label: "University" }, { value: "10", label: "Postgraduate" }
                ],
                OPTIONS_OCC: [
                    { value: "", label: "-- Select --" },
                    { value: "0", label: "Non-applicable (death/divorce)", na: true },
                    { value: "0", label: "Non-working / Housewife" }, { value: "1", label: "Unskilled manual" },
                    { value: "2", label: "Skilled manual" }, { value: "3", label: "Army/Police" },
                    { value: "4", label: "Business/Trade" }, { value: "5", label: "Clerical" },
                    { value: "6", label: "Professional/Director" }
                ]
            }
        };

        const LANGUAGES = { en: LANG_EN, ar: LANG_AR };
        let CURRENT_LANG = LANGUAGES.en;
        const INITIAL_MAX_SCORE = 45, SPOUSE_MAX_CONTRIB = 16, INCOME_MAX = 3, ASSETS_MAX = 10;

        function populateSelect(id, options) {
            document.getElementById(id).innerHTML = options.map(o => `<option value="${o.value}">${o.label}</option>`).join('');
        }

        function setLanguage(langCode) {
            CURRENT_LANG = LANGUAGES[langCode];
            const S = CURRENT_LANG.strings;
            document.documentElement.lang = CURRENT_LANG.code;
            document.documentElement.dir = CURRENT_LANG.dir;
            document.body.classList.toggle('text-right-rtl', CURRENT_LANG.dir === 'rtl');
            
            document.getElementById('main-title').textContent = S.TITLE;
            document.getElementById('welcome-title').textContent = S.WELCOME_TITLE;
            document.getElementById('welcome-text').innerHTML = S.WELCOME_TEXT_HTML;
            document.getElementById('start-button').textContent = S.START_CALCULATION;
            
            ['edu_h', 'occ_h', 'edu_w', 'occ_w'].forEach(id => populateSelect(id, S[id.startsWith('edu') ? 'OPTIONS_EDU' : 'OPTIONS_OCC']));
            
            document.getElementById('calc-title').textContent = S.CALCULATION_TITLE;
            document.getElementById('finance-title').textContent = S.FINANCE_TITLE;
            document.getElementById('husband-title').textContent = S.HUSBAND_TITLE;
            document.getElementById('wife-title').textContent = S.WIFE_TITLE;
            document.getElementById('edu-h-label').textContent = S.EDU_LABEL;
            document.getElementById('occ-h-label').textContent = S.OCC_LABEL;
            document.getElementById('edu-w-label').textContent = S.EDU_LABEL;
            document.getElementById('occ-w-label').textContent = S.OCC_LABEL;
            document.getElementById('income-title').textContent = S.INCOME_TITLE;
            document.getElementById('assets-title').textContent = S.ASSETS_TITLE;
            document.getElementById('calculate-button').textContent = S.CALCULATE_BUTTON;
            document.getElementById('results-title').textContent = S.RESULTS_TITLE;
            document.getElementById('breakdown-title').textContent = S.SCORE_BREAKDOWN;
            document.getElementById('th-domain').textContent = S.TABLE_DOMAIN;
            document.getElementById('th-score').textContent = S.TABLE_SCORE;
            document.getElementById('th-max').textContent = S.TABLE_MAX;
            document.getElementById('start-again-button').textContent = S.START_AGAIN;

            const incomeOpts = CURRENT_LANG.code === 'ar' ? ["ูุณุชุฏูู", "ูููู ุงูุฃุณุงุณูุงุช ุจุงููุงุฏ", "ูููู ุงูุฃุณุงุณูุงุช ูุงูุทูุงุฑุฆ", "ูุฏุฎุฑ ููุณุชุซูุฑ"] : ["Indebt", "Barely meets needs", "Meets needs + emergencies", "Saves/Invests"];
            document.getElementById('income-radio-group').innerHTML = incomeOpts.map((o, i) => `<div class="flex items-center space-x-3 ${CURRENT_LANG.dir === 'rtl' ? 'space-x-reverse' : ''}"><input id="inc_${i}" name="income" type="radio" value="${i}" class="h-4 w-4 text-blue-600 border-gray-300"><label for="inc_${i}" class="text-sm font-medium text-gray-700">${o}</label></div>`).join('');

            const assets = CURRENT_LANG.code === 'ar' ? ["ุซูุงุฌุฉ", "ุบุณุงูุฉ ุฃูุชููุงุชูู", "ูุงุชู ุฐูู", "ูููู ููุงุก", "ุฃุฑุถ ุฒุฑุงุนูุฉ", "ุฃุฑุถ ูููุจุงูู", "ูุญู ุชุฌุงุฑู / ูุฒุฑุนุฉ ููุงุดู", "ููุฒู ุขุฎุฑ", "ุณูุงุฑุฉ", "ููุจููุชุฑ"] : ["Refrigerator", "Auto Washer", "Smartphone", "Air Conditioner", "Agri Land", "Land for Housing", "Shop/Farm", "Another House", "Car", "Computer"];
            document.getElementById('assets-checkbox-group').innerHTML = assets.map((o, i) => `<div class="flex items-center space-x-3 ${CURRENT_LANG.dir === 'rtl' ? 'space-x-reverse' : ''}"><input id="ast_${i}" name="assets" type="checkbox" value="1" class="h-4 w-4 text-blue-600 rounded border-gray-300"><label for="ast_${i}" class="text-sm font-medium text-gray-700">${o}</label></div>`).join('');

            document.getElementById('language-select-screen').classList.add('hidden');
            document.getElementById('intro-screen').classList.remove('hidden');
        }

        function startCalculation() { document.getElementById('intro-screen').classList.add('hidden'); document.getElementById('calculator-screen').classList.remove('hidden'); document.getElementById('ses-form').reset(); document.getElementById('error-message').classList.add('hidden'); }
        function startAgain() { document.getElementById('results-screen').classList.add('hidden'); document.getElementById('intro-screen').classList.remove('hidden'); }

        function calculateSES() {
            const S = CURRENT_LANG.strings, getVal = id => document.getElementById(id).value, getTxt = id => { const e = document.getElementById(id); return e.options[e.selectedIndex].text; };
            const incRadio = document.querySelector('input[name="income"]:checked');
            if (!getVal('edu_h') || !getVal('edu_w') || !getVal('occ_h') || !getVal('occ_w') || !incRadio) { document.getElementById('error-message').textContent = S.ERROR_MISSING; document.getElementById('error-message').classList.remove('hidden'); return; }
            const naLabel = S.OPTIONS_EDU.find(o => o.na).label;
            const hEduNA = getTxt('edu_h').includes(naLabel), hOccNA = getTxt('occ_h').includes(naLabel);
            const wEduNA = getTxt('edu_w').includes(naLabel), wOccNA = getTxt('occ_w').includes(naLabel);
            if (hEduNA !== hOccNA || wEduNA !== wOccNA) { document.getElementById('error-message').textContent = S.ERROR_NA_INCONSISTENT; document.getElementById('error-message').classList.remove('hidden'); return; }
            if (hEduNA && hOccNA && wEduNA && wOccNA) { document.getElementById('error-message').textContent = S.ERROR_NA_BOTH; document.getElementById('error-message').classList.remove('hidden'); return; }
            document.getElementById('error-message').classList.add('hidden');
            const scoreEdu = parseInt(getVal('edu_h')) + parseInt(getVal('edu_w')), scoreOcc = parseInt(getVal('occ_h')) + parseInt(getVal('occ_w')), scoreInc = parseInt(incRadio.value), scoreAst = Array.from(document.querySelectorAll('input[name="assets"]:checked')).length;
            let total = scoreEdu + scoreOcc + scoreInc + scoreAst, max = INITIAL_MAX_SCORE;
            if (hEduNA && hOccNA) max -= SPOUSE_MAX_CONTRIB; if (wEduNA && wOccNA) max -= SPOUSE_MAX_CONTRIB;
            const pct = (total / max) * 100;
            let level, color;
            if (pct >= 76) { level = S.CLASSIFICATIONS.HIGH; color = "text-green-800"; } else if (pct >= 51) { level = S.CLASSIFICATIONS.MIDDLE; color = "text-blue-800"; } else if (pct >= 26) { level = S.CLASSIFICATIONS.LOW; color = "text-yellow-700"; } else { level = S.CLASSIFICATIONS.VERY_LOW; color = "text-red-800"; }
            document.getElementById('calculator-screen').classList.add('hidden'); document.getElementById('results-screen').classList.remove('hidden');
            document.getElementById('result-score').innerHTML = `<p class="text-base text-green-700">${S.SCORE_TOTAL} ${max}</p><p class="text-4xl font-extrabold ${color}">${total} / ${max}</p>`;
            document.getElementById('result-classification').innerHTML = `<p class="text-xl text-green-800 font-semibold">${S.CLASSIFICATION_FINAL}</p><p class="text-3xl font-bold ${color} mt-1">${level}</p><p class="text-lg text-green-700 mt-1">(${pct.toFixed(1)}%)</p>`;
            document.getElementById('breakdown-body').innerHTML = [{ d: S.DOMAIN_EDU, s: scoreEdu, m: (hEduNA?0:10)+(wEduNA?0:10) }, { d: S.DOMAIN_OCC, s: scoreOcc, m: (hOccNA?0:6)+(wOccNA?0:6) }, { d: S.DOMAIN_INC, s: scoreInc, m: INCOME_MAX }, { d: S.DOMAIN_ASSET, s: scoreAst, m: ASSETS_MAX }].map(i => `<tr class="hover:bg-gray-50"><td class="py-3 px-4 text-gray-800 text-left-rtl">${i.d}</td><td class="py-3 px-4 text-gray-800 text-center font-medium">${i.s}</td><td class="py-3 px-4 text-gray-600 text-center">${i.m}</td></tr>`).join('');
        }
    </script>
</body>
</html>
