<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Family Socioeconomic Status Scale (FSESS) Calculator</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Cairo:wght@400;700&display=swap');
body { font-family: 'Inter', sans-serif; background:#f7f7f7; }
[dir="rtl"] body { font-family: 'Cairo', sans-serif; text-align:right; }
</style>
</head>

<body class="p-4 sm:p-8">

<!-- ================= FIREBASE SDK ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

window.initializeApp = initializeApp;
window.getAuth = getAuth;
window.signInAnonymously = signInAnonymously;
window.getFirestore = getFirestore;
window.collection = collection;
window.addDoc = addDoc;
</script>

<div class="max-w-4xl mx-auto bg-white p-6 rounded-xl shadow">

<h1 class="text-3xl font-bold text-blue-700 mb-4">
Family Socioeconomic Status Scale (FSESS) Calculator
</h1>

<p class="text-gray-700 mb-6">
This tool implements the validated four-domain scoring system (Education, Occupation, Income, and Assets)
as published in the supplementary material of
<strong>El-Gilany A., Baklola M., Terra M., et al.
Refinement and validation of the Family Socioeconomic Status Scale (FSESS) for health research in Egypt.
BMC Public Health (2026).</strong>
</p>

<!-- ================= FORM ================= -->
<form id="fsess-form" class="space-y-6">

<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div>
<label class="font-semibold">Husband Education</label>
<select id="edu_h" class="w-full border p-2 rounded">
<option value="">-- Select --</option>
<option value="2">Illiterate</option>
<option value="4">Less than secondary</option>
<option value="6">Secondary</option>
<option value="8">University</option>
<option value="10">Postgraduate</option>
</select>
</div>

<div>
<label class="font-semibold">Wife Education</label>
<select id="edu_w" class="w-full border p-2 rounded">
<option value="">-- Select --</option>
<option value="2">Illiterate</option>
<option value="4">Less than secondary</option>
<option value="6">Secondary</option>
<option value="8">University</option>
<option value="10">Postgraduate</option>
</select>
</div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div>
<label class="font-semibold">Husband Occupation</label>
<select id="occ_h" class="w-full border p-2 rounded">
<option value="">-- Select --</option>
<option value="1">Unskilled</option>
<option value="2">Skilled</option>
<option value="4">Business</option>
<option value="6">Professional</option>
</select>
</div>

<div>
<label class="font-semibold">Wife Occupation</label>
<select id="occ_w" class="w-full border p-2 rounded">
<option value="">-- Select --</option>
<option value="1">Unskilled</option>
<option value="2">Skilled</option>
<option value="4">Business</option>
<option value="6">Professional</option>
</select>
</div>
</div>

<div>
<label class="font-semibold">Family Income</label>
<select id="income" class="w-full border p-2 rounded">
<option value="">-- Select --</option>
<option value="0">Indebted</option>
<option value="1">Barely meets needs</option>
<option value="2">Meets needs + emergencies</option>
<option value="3">Saves & invests</option>
</select>
</div>

<div>
<label class="font-semibold">Assets</label>
<div class="grid grid-cols-2 gap-2">
<label><input type="checkbox" value="refrigerator"> Refrigerator</label>
<label><input type="checkbox" value="washing_machine"> Washing Machine</label>
<label><input type="checkbox" value="smartphone"> Smartphone</label>
<label><input type="checkbox" value="air_conditioner"> Air Conditioner</label>
<label><input type="checkbox" value="car"> Car</label>
<label><input type="checkbox" value="computer"> Computer</label>
</div>
</div>

<button type="button" onclick="calculateAndSave()"
class="bg-blue-600 text-white px-6 py-3 rounded-lg w-full">
Calculate & Save
</button>
</form>

<div id="result" class="mt-6 text-xl font-bold"></div>
<div id="status" class="mt-2 text-sm text-gray-600"></div>

</div>

<script>
/* ================= FIREBASE INIT ================= */
const firebaseConfig = JSON.parse(
typeof __firebase_config !== "undefined" ? __firebase_config : "{}"
);
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
signInAnonymously(getAuth(app));

/* ================= SAFE SESSION ================= */
const sessionId = crypto.randomUUID().slice(0,10);

/* ================= CALCULATION ================= */
function calculateAndSave() {
const edu_h = +document.getElementById("edu_h").value || 0;
const edu_w = +document.getElementById("edu_w").value || 0;
const occ_h = +document.getElementById("occ_h").value || 0;
const occ_w = +document.getElementById("occ_w").value || 0;
const income = +document.getElementById("income").value || 0;

const assetInputs = document.querySelectorAll("input[type=checkbox]");
let assets = {};
let assetScore = 0;
assetInputs.forEach(a=>{
assets[a.value] = a.checked;
if(a.checked) assetScore++;
});

const totalScore = edu_h + edu_w + occ_h + occ_w + income + assetScore;
const classification =
totalScore >= 35 ? "High" :
totalScore >= 25 ? "Middle" :
totalScore >= 15 ? "Low" : "Very Low";

document.getElementById("result").innerText =
`Total Score: ${totalScore} → ${classification}`;

/* ================= RAW STORAGE ================= */
addDoc(collection(db,"raw_responses"),{
session_id: sessionId,
date: new Date().toISOString().split("T")[0],
education:{husband:edu_h,wife:edu_w},
occupation:{husband:occ_h,wife:occ_w},
income_category: income,
assets: assets,
derived:{total_score:totalScore,classification},
tool_version:"v1.0",
data_use:"research_and_tool_validation"
});

/* ================= ANALYTICS ================= */
addDoc(collection(db,"analytics_views"),{
date:new Date().toISOString().split("T")[0],
total_score:totalScore,
classification,
domain_scores:{
education:edu_h+edu_w,
occupation:occ_h+occ_w,
income,
assets:assetScore
},
tool_version:"v1.0"
});

document.getElementById("status").innerText =
"✔ Data saved anonymously for research use.";
}
</script>

</body>
</html>
